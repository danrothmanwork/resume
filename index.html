<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Dan Rothman — Principal Engineer resume, skills, and experience." />
  <title>Dan Rothman — Resume</title>

  <!-- Performance: establish early connections for Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />

  <!-- Bootstrap (CSS only) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />

  <link rel="icon" href="/favicon.ico" />
  <meta name="theme-color" content="#121212" media="(prefers-color-scheme: dark)">
  <meta name="theme-color" content="#f8f9fa" media="(prefers-color-scheme: light)">

  <!-- Open Graph / Twitter basics -->
  <meta property="og:title" content="Dan Rothman — Resume" />
  <meta property="og:description" content="Principal Engineer focused on VxRail & PowerFlex. Ten years of enterprise support at Dell." />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="profile.jpg" />
  <meta name="twitter:card" content="summary" />

  <style>
    /* -----------------------------
       Design tokens (light/dark)
    ------------------------------ */
    :root {
      --bg: #f8f9fa;
      --text: #222;
      --muted: #6c757d;
      --card-bg: #fff;
      --border: rgba(0,0,0,.08);
      --shadow: 0 2px 16px rgba(0,0,0,.08);
      --link: #0d6efd;
      --chip-bg: #eef1f4;
    }
    [data-theme="dark"] {
      --bg: #121212;
      --text: #f1f3f5;
      --muted: #b7bbc0;
      --card-bg: #1a1a1a;
      --border: rgba(255,255,255,.06);
      --shadow: 0 2px 16px rgba(0,0,0,.4);
      --link: #66b2ff;
      --chip-bg: #26292c;
      --bs-secondary-color: #aab2bf;          /* ~8.8:1 contrast on #121212 */
      --bs-secondary-color-rgb: 170, 178, 191;
    }

    html { scroll-behavior: smooth; }
    body { background: var(--bg); color: var(--text); font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji"; }

    /* a11y: visible focus */
    :focus-visible { outline: 3px solid var(--link); outline-offset: 2px; }
    .skip-link { position: absolute; left: -9999px; top: auto; width: 1px; height: 1px; overflow: hidden; }
    .skip-link:focus { left: 12px; top: 12px; width: auto; height: auto; padding: .5rem .75rem; background: var(--card-bg); border: 1px solid var(--border); border-radius: .5rem; box-shadow: var(--shadow); }

    /* Layout: CSS Grid with sticky aside (no overlap/clipping) */
    .layout { display: grid; grid-template-columns: 1fr; gap: 1rem; max-width: 1060px; margin: 0 auto; padding: 1rem; }
    @media (min-width: 992px) {
      .layout {
        grid-template-columns: 260px 1fr;
        gap: 2rem;
        padding: 2rem;
      }
      aside[aria-label="Sidebar"] {
        position: sticky;
        top: 20px;
        align-self: start;
        min-height: 1px;
      }
    }
    header.site-header { margin-bottom: .5rem; }

    /* Header opacity is driven by JS; no CSS transition lag */
    header.site-header {
      will-change: opacity;
      transition: opacity 0s linear;
    }

    /* Cards */
    .card-like { background: var(--card-bg); border: 1px solid var(--border); border-radius: .75rem; box-shadow: var(--shadow); padding: 1.25rem; }
    .sub-card { border: 1px solid var(--border); border-radius: .75rem; padding: 1rem; margin-bottom: 1rem; background: var(--card-bg); }

    /* Sidebar */
    .profile-img { width: 120px; height: 120px; display: block; }
    @media (min-width: 992px) { .profile-img { width: 140px; height: 140px; } }

    /* Sidebar nav using Bootstrap nav-pills + left stripe when active */
    .sidebar-nav .nav-link {
      color: var(--text);
      border-radius: .25rem;
      padding: .35rem .25rem .35rem .75rem;
    }
    .sidebar-nav .nav-link:hover {
      color: var(--link);
      background: transparent;
    }
    .sidebar-nav .nav-link[aria-current="true"] {
      background: transparent;
      font-weight: 700;
      position: relative;
    }
    .sidebar-nav .nav-link[aria-current="true"]::before {
      content: "";
      position: absolute;
      left: 0; top: 0; bottom: 0;
      width: 3px;
      background: var(--link);
      border-radius: .25rem;
    }

    /* Chips */
    .chips span { display: inline-block; background: var(--chip-bg); border-radius: .5rem; padding: .3rem .6rem; margin: .2rem .2rem 0 0; font-size: .92rem; }

    /* Print: clean PDF without sidebar/buttons */
    @media print {
      .layout { display: block; max-width: 100%; padding: 0; }
      aside, .fab { display: none !important; }
      .card-like, .sub-card { break-inside: avoid; box-shadow: none; border-color: #ccc; }
      a[href^="http"]::after { content: " (" attr(href) ")"; font-weight: normal; font-size: 10pt; }
    }

    /* Motion safety */
    @media (prefers-reduced-motion: reduce) { html { scroll-behavior: auto; } * { transition: none !important; animation: none !important; } }

    /* FAB positioning */
    .fab {
      position: fixed;
      bottom: 16px;
      right: 16px;
      display: grid;
      gap: 10px;
      z-index: 9999;
    }
    .fab .btn { width: 48px; height: 48px; padding: 0; display: grid; place-items: center; }

    .btn-surface {
      --bs-btn-bg: var(--card-bg);
      --bs-btn-color: var(--text);
      --bs-btn-border-color: var(--border);
      --bs-btn-hover-bg: var(--chip-bg);
      --bs-btn-hover-border-color: var(--border);
      --bs-btn-active-bg: var(--chip-bg);
      --bs-btn-active-border-color: var(--border);
      --bs-btn-focus-shadow-rgb: 13,110,253;
    }

    .fab :focus-visible,
    .sidebar-nav :focus-visible,
    .card-like :focus-visible {
      outline: 3px solid var(--link);
      outline-offset: 2px;
    }

    .contact-row { display: inline-flex; align-items: center; gap: .5rem; }
    .contact-row--block { display: flex; align-items: center; gap: .5rem; }

    @media (max-width: 991.98px) { aside[aria-label="Sidebar"] { display: none; } }
   
    /* --- Sidebar slide-down + scroll-synced crossfade --- */
    .js-profile-card {
      overflow: hidden;

      /* driven by JS */
      --fade: 0;
      --cardH: 0px;

      height: var(--cardH);
      opacity: var(--fade);
      transform: translateY(calc(12px * (1 - var(--fade))));

      /* smooth slide + subtle ease */
      transition:
        height 240ms cubic-bezier(.22,.61,.36,1),
        opacity 120ms linear,
        transform 220ms cubic-bezier(.22,.61,.36,1);
      will-change: height, opacity, transform;
    }

    .js-profile-card .profile-img,
    .js-profile-card .contact p {
      opacity: var(--fade);
      transform: translateY(calc(6px * (1 - var(--fade))));
      transition: opacity 120ms linear, transform 220ms cubic-bezier(.22,.61,.36,1);
    }

    @media (prefers-reduced-motion: reduce) {
      .js-profile-card,
      .js-profile-card .profile-img,
      .js-profile-card .contact p { transition: none !important; }
    }

  </style>
</head>
<body>
  <a class="skip-link" href="#content">Skip to content</a>

  <header class="site-header py-4">
    <div class="container-xxl text-center px-3">

      <img src="./profile.jpg" alt="Dan Rothman headshot"
          width="150" height="150"
          class="profile-img rounded-circle object-fit-cover mb-3 mx-auto d-block"
          fetchpriority="high"
          onerror="this.style.display='none'">

      <h1 class="h2 mb-1">Dan Rothman</h1>

      <!-- Location -->
      <div class="contact-row mb-2">
        <i class="bi bi-geo-alt" aria-hidden="true"></i>
        <span>Oklahoma City, OK</span>
      </div>

      <!-- Phone + Email -->
      <div class="contact-row d-flex flex-column flex-md-row justify-content-center mb-2">
        <div class="me-md-4">
          <i class="bi bi-telephone" aria-hidden="true"></i>
          <a href="tel:+12064327106">+1 (206) 432-7106</a>
        </div>
        <div>
          <i class="bi bi-envelope" aria-hidden="true"></i>
          <a href="mailto:dan@rothman.work">dan@rothman.work</a>
        </div>
      </div>

      <!-- Website + LinkedIn -->
      <div class="contact-row d-flex flex-column flex-md-row justify-content-center">
        <div class="me-md-4">
          <i class="bi bi-globe" aria-hidden="true"></i>
          <a href="https://dan.rothman.work" target="_blank" rel="noopener">dan.rothman.work</a>
        </div>
        <div>
          <i class="bi bi-linkedin" aria-hidden="true"></i>
          <a href="https://www.linkedin.com/in/dan-rothman" target="_blank" rel="noopener">linkedin.com/in/dan-rothman</a>
        </div>
      </div>

    </div>
  </header>

  <!-- Nav buttons -->
  <div class="fab" aria-label="page actions">
    <button class="js-theme-toggle btn btn-surface rounded-circle shadow-sm border" type="button" aria-pressed="false">
      <i class="bi bi-moon-stars" aria-hidden="true"></i>
      <span class="visually-hidden">Toggle theme</span>
    </button>
    <a href="dan_rothman_resume.pdf" target="_blank" rel="noopener" class="btn btn-surface rounded-circle shadow-sm border" aria-label="Open PDF">
      <i class="bi bi-download" aria-hidden="true"></i>
    </a>
  </div>

  <div class="layout" id="content">
    <aside aria-label="Sidebar">
      <div class="card-like mb-3 text-center js-profile-card" style="display:none">
        <img src="profile.jpg" alt="Dan Rothman headshot" class="profile-img rounded-circle object-fit-cover mx-auto mb-3" width="140" height="140" loading="lazy" />
        <div class="contact text-start small">
          <p class="mb-1"><i class="bi bi-geo-alt me-1" aria-hidden="true"></i> Oklahoma City, OK</p>
          <p class="mb-1"><i class="bi bi-telephone me-1" aria-hidden="true"></i> <a href="tel:+12064327106">+1 (206) 432-7106</a></p>
          <p class="mb-1"><i class="bi bi-envelope me-1" aria-hidden="true"></i> <a href="mailto:dan@rothman.work">dan@rothman.work</a></p>
          <p class="mb-1"><i class="bi bi-globe me-1" aria-hidden="true"></i> <a href="https://dan.rothman.work" target="_blank" rel="noopener">dan.rothman.work</a></p>
          <p class="mb-0"><i class="bi bi-linkedin me-1" aria-hidden="true"></i> <a href="https://www.linkedin.com/in/dan-rothman" target="_blank" rel="noopener">linkedin.com/in/dan-rothman</a></p>
        </div>
      </div>

      <!-- Sidebar nav TEXT updated to match old resume -->
      <nav class="card-like sidebar-nav" aria-label="Section navigation">
        <ul class="nav nav-pills flex-column m-0">
          <li class="nav-item"><a class="nav-link" href="#summary">Summary</a></li>
          <li class="nav-item">
            <a class="nav-link" href="#experience">Experience</a>
            <ul class="list-unstyled ps-2 mt-1">
              <li><a class="nav-link" href="#exp-principal-engineer">Principal Engineer</a></li>
              <li><a class="nav-link" href="#exp-senior-engineer">Senior Engineer</a></li>
              <li><a class="nav-link" href="#exp-technical-support-engineer">Technical Support Engineer</a></li>
              <li><a class="nav-link" href="#exp-analyst">Enterprise Tech Support Analyst</a></li>
            </ul>
          </li>
          <li class="nav-item"><a class="nav-link" href="#certifications">Certifications</a></li>
          <li class="nav-item"><a class="nav-link" href="#awards">Awards</a></li>
          <li class="nav-item"><a class="nav-link" href="#skills">Skills</a></li>
        </ul>
      </nav>
    </aside>

    <main>
      <!-- Summary (replaced with old content) -->
      <section id="summary" class="card-like mb-3" aria-labelledby="summary-h">
        <h2 id="summary-h" class="h4">Professional Summary</h2>
        <p class="mb-0">
          Principal Support Engineer specializing in enterprise infrastructure solutions, with a decade of progressive experience at Dell Technologies.
          Expert in hyper-converged systems (VxRail, PowerFlex), VMware environments, and containerized platforms. Proven history supporting mission-critical
          systems for Fortune 100 clients including Wells Fargo and BNY Mellon. Skilled in root cause analysis, incident management, and cross-functional
          collaboration. Known for technical leadership, mentoring, and delivering initiative-taking solutions that drive customer success and system stability.
        </p>
      </section>

      <!-- Experience (replaced with old content) -->
      <section id="experience" class="card-like mb-3" aria-labelledby="experience-h">
        <h2 id="experience-h" class="h4">Professional Experience</h2>
        <article class="mb-3">
          <header class="mb-2">
            <h3 id="dell" class="h5 m-0">Dell Technologies</h3>
            <p class="text-muted small m-0">Oklahoma City, OK · Nov 2015 – Present</p>
          </header>

          <div class="sub-card" id="exp-principal-engineer">
            <h4 class="h6 m-0">Principal Engineer</h4>
            <p class="text-muted small mb-2">May 2021 – Present</p>
            <ul class="mb-0">
              <li>Dedicated Support Engineer for Fortune 100 financial institutions, ensuring stability and reliability of mission-critical infrastructure.</li>
              <li>Supported and maintained <strong>10,000+</strong> Dell VxRail hyper-converged infrastructure (HCI) nodes and over <strong>15,000</strong> Dell PowerFlex compute-only, storage-only, and hyper-converged nodes.</li>
              <li>Delivered expertise in VMware vSAN, Dell VxRail, and Dell PowerFlex software-defined storage solutions, including containerized workloads on Kubernetes.</li>
              <li>Partnered with VMware Technical Account Managers (TAMs) to align infrastructure health, stability, and performance with customer business goals.</li>
              <li>Advised and assisted Dell’s internal deployment, upgrade, account, engineering, and escalation teams, as well as customer DevOps and production teams, ensuring consistent success across deployment, operations, and incident response.</li>
              <li>Proactively identified systemic risks such as hardware degradation, capacity shortfalls, and firmware gaps, implementing preventative measures that reduced unplanned downtime.</li>
              <li>Advised, reviewed, and validated customer-specific documentation, runbooks, and best practice guides, ensuring clarity, accuracy, and operational efficiency across teams.</li>
              <li>Compiled and presented quarterly business reviews (QBRs) to senior stakeholders, translating technical performance into measurable business value and actionable insights.</li>
              <li>Served as a trusted advisor, influencing infrastructure architecture decisions and guiding adoption of emerging Dell and VMware technologies.</li>
            </ul>
          </div>

          <div class="sub-card" id="exp-senior-engineer">
            <h4 class="h6 m-0">Senior Engineer</h4>
            <p class="text-muted small mb-2">Nov 2019 – Nov 2021</p>
            <ul class="mb-0">
              <li>Managed production-impacting escalations as the senior escalation owner for VxRail environments.</li>
              <li>Lead root cause analyses and deliver comprehensive post-incident reports with actionable remediation plans.</li>
              <li>Administer and troubleshoot VMware ESXi, and vCenter environments to ensure stability and optimal performance.</li>
              <li>Led recovery efforts and coordinated cross-functional teams to implement preventive solutions.</li>
              <li>Authored detailed knowledge base articles and technical training materials.</li>
              <li>Mentored frontline engineers to improve diagnostic accuracy and case management.</li>
              <li>Led the resolution of critical thermal issues at BNY Mellon’s data center, leveraging log analysis to identify airflow deficiencies. The fix stabilized operations and earned customer trust, resulting in a request for me as their dedicated engineer.</li>
            </ul>
          </div>

          <div class="sub-card" id="exp-technical-support-engineer">
            <h4 class="h6 m-0">Technical Support Engineer</h4>
            <p class="text-muted small mb-2">Jan 2017 – Nov 2019</p>
            <ul class="mb-0">
              <li>Delivered ProSupport Plus, Dell’s highest level of support, to Fortune 100 and enterprise accounts.</li>
              <li>Provided end-to-end support across Dell’s hardware portfolio including Modular, PowerEdge, and emerging cloud infrastructure platforms.</li>
              <li>Supported diverse enterprise operating systems including VMware, Windows Server, Linux, and Nutanix.</li>
              <li>Served as the team’s Networking Subject Matter Expert (SME), resolving complex multi-layer issues across environments.</li>
              <li>Transitioned to the VxRail team, specializing exclusively in VMware HCI; recognized as a “VxRail Xpert” for technical excellence.</li>
              <li>Promoted to Technical Team Lead for outstanding technical knowledge, customer communication, and cross-team leadership.</li>
              <li>Trained and mentored new engineers; authored and maintained a central technical documentation repository to streamline case handling.</li>
              <li>Provided strategic guidance on critical customer escalations, collaborating cross-functionally with engineering and product teams.</li>
              <li>Promoted to Senior Engineer in recognition of significant technical contributions and leadership impact on team success.</li>
            </ul>
          </div>

          <div class="sub-card" id="exp-analyst">
            <h4 class="h6 m-0">Enterprise Tech Support Analyst</h4>
            <p class="text-muted small mb-2">Nov 2015 – Jan 2017</p>
            <ul class="mb-0">
              <li>Delivered enterprise-grade support for PowerEdge servers running VMware, Linux, and Windows.</li>
              <li>Mentored new analysts and contributed to internal training.</li>
              <li>Recognized as a top performer and CCNA-certified networking SME.</li>
              <li>Selected for Early Life Support team to debug hardware issues with new generation PowerEdge hardware and to field the first support calls.</li>
            </ul>
          </div>
        </article>
      </section>

      <!-- Certifications (replaced with old content) -->
      <section id="certifications" class="card-like mb-3" aria-labelledby="cert-h">
        <h2 id="cert-h" class="h4">Certifications</h2>
        <p class="chips mb-0">
          <span>VMware Certified Professional 6 – Data Center Virtualization (VCP6-DCV)</span>
          <span>VxRail Xpert</span>
          <span>Cisco Certified Network Associate (CCNA) – exp. 2019 - CSCO12950075</span>
          <span>CompTIA Network+ - exp. 2018</span>
        </p>
      </section>

      <!-- Awards (replaced with old content) -->
      <section id="awards" class="card-like mb-3" aria-labelledby="awards-h">
        <h2 id="awards-h" class="h4">Awards</h2>
        <p class="chips mb-0">
          <span>On the Spot Award – Recognized for fostering team morale. (2015)</span>
          <span>On the Spot Award – For (2016)</span>
          <span>Top Performer Award – Top Performing Engineer (2017)</span>
          <span>Award – Contributions to Wells Fargo’s first PowerFlex migration from 3.x to 4.x</span>
        </p>
      </section>

      <!-- Skills (replaced with old content) -->
      <section id="skills" class="card-like mb-3" aria-labelledby="skills-h">
        <h2 id="skills-h" class="h4">Technical Skills</h2>
        <p class="chips mb-0">
          <span>PowerFlex</span><span>VxRail</span><span>VMware vSphere/VCF</span><span>PowerEdge</span>
          <span>vSAN</span><span>Nutanix</span><span>Kubernetes</span><span>Docker</span>
          <span>Bash</span><span>PowerShell</span><span>REST APIs</span><span>Root Cause Analysis</span>
          <span>Incident Management</span><span>Technical Mentorship</span><span>Documentation</span><span>Customer Communication</span>
          <span>Escalation Management</span>
        </p>
      </section>
    </main>
  </div>

<!-- JSON-LD: Person schema -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Person",
  "name": "Dan Rothman",
  "jobTitle": "Principal Engineer",
  "image": "profile.jpg",
  "url": "https://dan.rothman.work",
  "email": "mailto:dan@rothman.work",
  "telephone": "+12064327106",
  "address": {"@type":"PostalAddress","addressLocality":"Oklahoma City","addressRegion":"OK","addressCountry":"US"},
  "sameAs": ["https://www.linkedin.com/in/dan-rothman"]
}
</script>

<script>
  // Theme toggle with system-pref fallback
  (function () {
    const root = document.documentElement;
    const toggles = document.querySelectorAll('.js-theme-toggle');
    const saved = localStorage.getItem('theme');
    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    const initial = saved || (prefersDark ? 'dark' : 'light');

    root.setAttribute('data-theme', initial);
    toggles.forEach(btn => btn.setAttribute('aria-pressed', initial === 'dark'));

    const flip = () => {
      const next = root.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
      root.setAttribute('data-theme', next);
      localStorage.setItem('theme', next);
      toggles.forEach(btn => btn.setAttribute('aria-pressed', next === 'dark'));
    };

    toggles.forEach(btn => btn.addEventListener('click', flip));
  })();
</script>

<script>
// Active link syncing based on section visibility
(function () {
  const links = Array.from(document.querySelectorAll('.sidebar-nav .nav-link[href^="#"]'));
  const idToLink = new Map();
  const targets = [];

  links.forEach(a => {
    const id = a.getAttribute('href').slice(1);
    const el = document.getElementById(id);
    if (el) { idToLink.set(id, a); targets.push(el); }
  });

  function setActive(id) {
    links.forEach(a => a.removeAttribute('aria-current'));
    const active = idToLink.get(id);
    if (active) active.setAttribute('aria-current', 'true');
  }

  const anchorRatio = 0.30; // 30% from top
  let ticking = false;

  function onScroll() {
    ticking = false;
    const anchorY = window.innerHeight * anchorRatio;

    // pick the last section whose top is above the anchor line
    let activeId = targets.length ? targets[0].id : null;
    for (const el of targets) {
      const top = el.getBoundingClientRect().top;
      if (top - anchorY <= 0) activeId = el.id; else break;
    }
    if (activeId) setActive(activeId);
  }

  window.addEventListener('scroll', () => {
    if (!ticking) { requestAnimationFrame(onScroll); ticking = true; }
  }, { passive: true });

  window.addEventListener('resize', onScroll, { passive: true });

  // initialize (also handles hash on load)
  if (location.hash && idToLink.has(location.hash.slice(1))) {
    setActive(location.hash.slice(1));
  } else {
    onScroll();
  }

  // set active immediately on click, then scroll handler will keep it updated
  links.forEach(a => a.addEventListener('click', () => {
    const id = a.getAttribute('href').slice(1);
    setActive(id);
  }));
})();
</script>

<script>
  (function () {
    const header = document.querySelector('header.site-header');
    const card = document.querySelector('.js-profile-card');
    const mq = window.matchMedia('(min-width: 992px)');
    if (!header || !card) return;

    // Smoothstep easing
    const ease = t => t * t * (3 - 2 * t);
    const clamp01 = x => Math.max(0, Math.min(1, x));

    // Crossfade window (unchanged) + slight scroll-ahead
    const START = 0.35;
    const END   = 0.02;
    const SCROLL_AHEAD_PX = 100;

    // helpers
    const setFade = f => card.style.setProperty('--fade', f.toFixed(3));
    const setH    = px => card.style.setProperty('--cardH', Math.max(0, Math.round(px)) + 'px');

    let prepared = false;
    let fullH = 0;

    function measureFullHeight() {
      // temporarily override height to let content expand, measure, then restore
      const prevInlineHeight = card.style.height;
      card.style.height = 'auto';
      fullH = card.scrollHeight || 0;
      card.style.height = prevInlineHeight;
    }

    function prepareCard() {
      if (prepared) return;
      card.style.display = '';
      setFade(0);
      // ensure we can measure once, invisibly
      const prev = card.style.height;
      card.style.height = 'auto';
      fullH = card.scrollHeight || 0;
      card.style.height = prev;
      setH(0);
      prepared = true;
    }

    function cleanupCard() {
      prepared = false;
      fullH = 0;
      setFade(0);
      setH(0);
      card.style.display = 'none';
    }

    function headerVisibleRatio() {
      const rect = header.getBoundingClientRect();
      const vh = window.innerHeight || document.documentElement.clientHeight;
      const visiblePx = Math.max(0, Math.min(rect.bottom, vh) - Math.max(rect.top, 0));
      const shifted = visiblePx - SCROLL_AHEAD_PX;
      return clamp01(shifted / Math.max(1, rect.height));
    }

    let ticking = false;
    function update() {
      ticking = false;

      // Hide sidebar entirely on mobile
      if (!mq.matches) {
        cleanupCard();
        header.style.opacity = '';
        return;
      }

      const ratio = headerVisibleRatio(); // 1..0 as header leaves (shifted)
      const progress = clamp01((START - ratio) / (START - END)); // 0→1 across band
      const eased = ease(progress);

      // fade header out
      header.style.opacity = (1 - eased).toFixed(3);

      if (progress <= 0) {
        // keep card invisible/collapsed while header is still up
        setFade(0);
        setH(0);
        if (prepared) cleanupCard();
        return;
      }

      // reveal & slide card
      if (!prepared) prepareCard();
      if (!fullH) measureFullHeight();

      setFade(eased);
      setH(fullH * eased);

      // snap to final dimensions when fully shown
      if (progress >= 1) {
        setFade(1);
        setH(fullH);
      }
    }

    function onScrollOrResize() {
      if (!ticking) {
        ticking = true;
        requestAnimationFrame(update);
      }
    }

    // Re-measure on resize (font size / text wrap can change height)
    window.addEventListener('resize', () => {
      if (prepared) {
        // temporarily let it expand to measure accurately
        const currVar = getComputedStyle(card).getPropertyValue('--cardH');
        card.style.height = 'auto';
        fullH = card.scrollHeight || fullH;
        card.style.height = ''; // back to CSS variable
      }
      onScrollOrResize();
    }, { passive: true });

    window.addEventListener('scroll', onScrollOrResize, { passive: true });
    mq.addEventListener('change', onScrollOrResize);

    // First paint
    update();
  })();
</script>

</body>
</html>